#<?cfg paf policy ?>
#
# Orchestration Layer Policy for a DC3 production
#
# Copy this file and modify as needed.
#
shortName:           DataRelease
eventBrokerHost:     lsst8.ncsa.uiuc.edu
repositoryDirectory: ./pipeline
productionShutdownTopic:       productionShutdown

# if a special productionRunConfigurator class is needed, specify it
# here; otherwise, the default will be instantiated
# configurationClass:  lsst.ctrl.orca.BasicProductionRunConfigurator
#
# if there is special configuration information associated with the 
# the class, it will go in here:
# configuration: {
# 
# }

# this is production-level database configuration.  Note that there can 
# be multiple database occurances.  The WorkflowConfigurator will create a
# DatabaseConfigurator for each entry.  Each must also be copied into the 
# pipeline config file.
# 
database: {

    name: dc3bGlobal

    system: {   
        authInfo: {
            host: lsst10.ncsa.uiuc.edu
            port: 3306
        }

        runCleanup: {
            daysFirstNotice: 7  # days when first notice is sent before run can be deleted
            daysFinalNotice: 1  # days when final notice is sent before run can be deleted
        }
    }

    configurationClass: lsst.ctrl.orca.db.DC3Configurator
    configuration: {  
        globalDbName: GlobalDB
        dcVersion: DC3b
        dcDbName: DC3b_DB
        minPercDiskSpaceReq: 10   # measured in percentages
        userRunLife: 2            # measured in weeks
    }
}

workflow: {
    shortName: PT1Workflow
    platform:  @platform/abecluster.paf
    shutdownTopic:       workflowShutdown

    configurationClass: lsst.ctrl.orca.VanillaCondorWorkflowConfigurator
    configuration: {
        # script creates symlinks to datar;  is called by orca:
        #    <script> <runid> <dataRepository> <collection>
        deployData: {
            dataRepository: /cfs/projects/lsst/DC3/data/obs
            collection: ImSim
            script: "$DATAREL_DIR/bin/runOrca/deployData-abe.sh"
        }
        # launchScript: 
        condorData: {
            localScratch: /home/rallsman/orca_scratch
            loginNode: login-abe.ncsa.teragrid.org
            ftpNode: gridftp-abe.ncsa.teragrid.org
            transferProtocol: gsiftp
        }
        glideinRequest: {
            keyValuePairs: {
                CONDOR_SBIN: /cfs/projects/lsst/DC3/opt/condor_glidein/7.4.2
                #CONDOR_ADMIN: srp@ncsa.uiuc.edu # should be filled in
                #START_OWNER: srp # user that will run job on remote system
                CPU_COUNT: 8 # number of cpus per machine
                MACHINE_COUNT: 1 # number of machines requested
                MAX_WALLTIME: 15 # maximum time to hold machines, in minutes
            }
            templateFileName: $CTRL_ORCA_DIR/etc/glidein_run.submit.dc3b
            outputFileName: glidein_request.condor
        }

    }

    pipeline: {
       shortName:     joboffices
       definition:    @imsim-joboffice-abe.paf
       runCount: 1
       deploy: {
          # the schema for this node is determined by the above 
          # configuration class.  In this case, we run on the first
          # slot the pipeline is assigned, since the nodes can not
          # be determined in advance.
       }
       launch: true
    }
    pipeline: {
       shortName:     isr
       definition:    @imsim-isr-master-abe.paf
       runCount: 4
       deploy: {
          # the schema for this node is determined by the above 
          # configuration class.  In this case, we run on the first
          # slot the pipeline is assigned, since the nodes can not
          # be determined in advance.
       }
       launch: true
    }
#    pipeline: {
#       shortName:     ccdassembly
#       definition:    @imsim-ca-master.paf
#       runCount: 2
#       deploy: {
#          processesOnNode: lsst6:1
#       }
#       launch: true
#    }
#    pipeline: {
#       shortName:     crsplit
#       definition:    @imsim-crSplit-master.paf
#       runCount: 1
#       deploy: {
#          processesOnNode: lsst7:1
#       }
#       launch: true
#    }
#    pipeline: {
#       shortName:     imgchar
#       definition:    @imsim-imgChar-master.paf
#       runCount: 1
#       deploy: {
#          processesOnNode: lsst6:1
#       }
#       launch: true
#    }
#    pipeline: {
#       shortName:     sfm
#       definition:    @imsim-sfm-master.paf
#       runCount: 1
#       deploy: {
#          processesOnNode: lsst7:1
#       }
#       launch: true
#    }
}
